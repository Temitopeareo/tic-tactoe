<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game Hub Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2678b6;
            --tg-theme-button-color: #3390ec;
            --tg-theme-button-text-color: #ffffff;
            --primary-color: #3390ec;
            --secondary-color: #f0f0f0;
            --accent-color: #ff5722;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --border-radius: 12px;
            --box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            transition: all var(--transition-speed) ease;
            overflow-x: hidden;
            line-height: 1.5;
            padding-bottom: 70px; /* Space for bottom navigation */
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            position: relative;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary-color), #2678b6);
            border-radius: var(--border-radius);
            color: white;
            box-shadow: var(--box-shadow);
        }

        .header h1 {
            font-size: 28px;
            margin: 0;
            padding: 10px 0;
            color: white;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent-color);
            color: white;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
        }

        .version {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
            font-weight: 500;
        }

        .game-modes {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
            gap: 12px;
        }

        .mode-btn {
            flex: 1;
            padding: 16px;
            margin: 0;
            background-color: var(--secondary-color);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            color: var(--tg-theme-text-color, #000000);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .mode-btn i {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .mode-btn.active {
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(51, 144, 236, 0.2);
        }

        .difficulty-selector {
            display: none;
            margin-bottom: 24px;
            text-align: center;
            background-color: var(--secondary-color);
            padding: 16px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .difficulty-selector.visible {
            display: block;
            animation: fadeIn 0.5s;
        }

        .difficulty-selector h3 {
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
        }

        .difficulty-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .difficulty-btn {
            flex: 1;
            padding: 12px;
            margin: 0;
            background-color: white;
            border: 2px solid var(--secondary-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            color: var(--tg-theme-text-color, #000000);
            font-weight: 500;
        }

        .difficulty-btn.active {
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        .game-id-container {
            display: none;
            margin-bottom: 24px;
            animation: fadeIn 0.5s;
            background-color: var(--secondary-color);
            padding: 16px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .game-id-container.visible {
            display: block;
        }

        .game-id-container h3 {
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
        }

        .game-id-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            box-sizing: border-box;
            margin-bottom: 12px;
            font-size: 18px;
            text-align: center;
            color: var(--tg-theme-text-color, #000000);
            background-color: var(--tg-theme-bg-color, #ffffff);
            font-weight: 600;
            letter-spacing: 2px;
            transition: all var(--transition-speed) ease;
        }

        .game-id-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(51, 144, 236, 0.2);
        }

        .game-id-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .game-id-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(51, 144, 236, 0.2);
        }

        .game-id-btn:active {
            transform: translateY(0);
        }

        .game-id-btn.secondary {
            background-color: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .board-container {
            position: relative;
            margin-bottom: 24px;
            perspective: 1000px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
            margin-bottom: 20px;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }

        .board.flip {
            transform: rotateY(180deg);
        }

        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            color: var(--tg-theme-text-color, #000000);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .cell:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            background-color: rgba(51, 144, 236, 0.1);
        }

        .cell:active {
            transform: translateY(0);
        }

        .cell.x {
            color: var(--error-color);
        }

        .cell.o {
            color: var(--primary-color);
        }

        .cell.win {
            animation: pulse 1s infinite;
            background-color: rgba(76, 175, 80, 0.2);
        }

        .cell-content {
            position: relative;
            z-index: 2;
        }

        .cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(51, 144, 236, 0.1);
            transform: scale(0);
            border-radius: 50%;
            transition: transform 0.5s;
            z-index: 1;
        }

        .cell:active::before {
            transform: scale(1);
        }

        .status {
            text-align: center;
            margin-bottom: 24px;
            font-weight: 600;
            min-height: 24px;
            color: var(--tg-theme-text-color, #000000);
            padding: 12px;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            font-size: 18px;
        }

        .status.win {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }

        .status.draw {
            background-color: rgba(255, 152, 0, 0.2);
            color: var(--warning-color);
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
            gap: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 14px;
            margin: 0;
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(51, 144, 236, 0.2);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .action-btn i {
            font-size: 18px;
        }

        .action-btn.secondary {
            background-color: var(--secondary-color);
            color: var(--tg-theme-text-color, #000000);
        }

        .profile-section {
            margin-bottom: 24px;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .profile-stats {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999999);
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-value {
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
        }

        .tabs {
            display: flex;
            margin-bottom: 16px;
            border-radius: var(--border-radius);
            overflow: hidden;
            background-color: var(--secondary-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background-color: white;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .leaderboard {
            margin-top: 0;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .leaderboard h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--tg-theme-text-color, #000000);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .leaderboard h2 i {
            color: var(--warning-color);
        }

        .leaderboard-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: all var(--transition-speed) ease;
        }

        .leaderboard-item:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .player-rank {
            font-weight: bold;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-size: 14px;
        }

        .top-rank {
            background: linear-gradient(135deg, #FFD700, #FFA000);
        }

        .player-info {
            display: flex;
            align-items: center;
            flex: 1;
            gap: 12px;
        }

        .player-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 16px;
        }

        .player-name {
            font-weight: 500;
        }

        .player-wins {
            font-weight: 600;
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--tg-theme-hint-color, #999999);
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(51, 144, 236, 0.1);
            border-radius: 50%;
            border-top-color: var(--tg-theme-button-color, #3390ec);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 10px;
        }

        .history {
            margin-top: 0;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .history h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--tg-theme-text-color, #000000);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .history-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .history-item {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .history-date {
            color: var(--tg-theme-hint-color, #999999);
        }

        .history-result {
            font-weight: 600;
        }

        .result-win {
            color: var(--success-color);
        }

        .result-loss {
            color: var(--error-color);
        }

        .result-draw {
            color: var(--warning-color);
        }

        .history-details {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .history-mode {
            background-color: var(--secondary-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .history-opponent {
            flex: 1;
            font-weight: 500;
        }

        .connection-status {
            position: fixed;
            bottom: 80px; /* Adjusted to be above bottom navigation */
            right: 16px;
            font-size: 12px;
            padding: 8px 12px;
            border-radius: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-speed) ease;
        }

        .connection-status.online {
            background-color: rgba(76, 175, 80, 0.9);
        }

        .connection-status.offline {
            background-color: rgba(244, 67, 54, 0.9);
        }

        .error-message {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
            padding: 12px;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            text-align: center;
            display: none;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--error-color);
        }

        .error-message.visible {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            animation: fadeIn 0.5s;
        }

        .success-message {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            padding: 12px;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            text-align: center;
            display: none;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--success-color);
        }

        .success-message.visible {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            animation: fadeIn 0.5s;
        }

        .game-id-display {
            background-color: rgba(51, 144, 236, 0.1);
            color: var(--primary-color);
            padding: 12px;
            border-radius: var(--border-radius);
            margin-top: 12px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 2px;
            font-size: 18px;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .game-id-display.visible {
            display: block;
            animation: fadeIn 0.5s;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--tg-theme-bg-color, #ffffff);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px;
            color: var(--tg-theme-hint-color, #999999);
            font-size: 12px;
            font-weight: 500;
            transition: all var(--transition-speed) ease;
            cursor: pointer;
            width: 20%;
            text-align: center;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-item:hover {
            color: var(--primary-color);
        }

        /* Game selection */
        .game-selection {
            display: none;
            margin-bottom: 24px;
        }

        .game-selection.visible {
            display: block;
            animation: fadeIn 0.5s;
        }

        .game-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: var(--box-shadow);
            transition: all var(--transition-speed) ease;
            cursor: pointer;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
        }

        .game-card-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .game-card-content {
            padding: 16px;
        }

        .game-card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .game-card-description {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .game-card-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999999);
        }

        /* RPS Game Styles */
        .rps-container {
            display: none;
            animation: fadeIn 0.5s;
        }

        .rps-container.visible {
            display: block;
        }

        .rps-choices {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
            gap: 12px;
        }

        .rps-choice {
            flex: 1;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .rps-choice:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .rps-choice.selected {
            background-color: rgba(51, 144, 236, 0.2);
            border: 2px solid var(--primary-color);
        }

        .rps-choice.win {
            background-color: rgba(76, 175, 80, 0.2);
            border: 2px solid var(--success-color);
        }

        .rps-choice.lose {
            background-color: rgba(244, 67, 54, 0.2);
            border: 2px solid var(--error-color);
        }

        .rps-choice i {
            font-size: 48px;
            color: var(--tg-theme-text-color, #000000);
        }

        .rps-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            gap: 12px;
        }

        .rps-player, .rps-computer {
            flex: 1;
            text-align: center;
        }

        .rps-vs {
            font-size: 20px;
            font-weight: 600;
            color: var(--tg-theme-hint-color, #999999);
        }

        .rps-choice-display {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
        }

        .rps-choice-display i {
            font-size: 40px;
        }

        .rps-choice-label {
            font-weight: 600;
            font-size: 14px;
        }

        /* Notifications */
        .notifications-container {
            display: none;
            animation: fadeIn 0.5s;
        }

        .notifications-container.visible {
            display: block;
        }

        .notification-item {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            color: var(--tg-theme-text-color, #000000);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .notification-time {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 12px;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .notification-btn {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .notification-btn.primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }

        .notification-btn.secondary {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        /* Profile */
        .profile-container {
            display: none;
            animation: fadeIn 0.5s;
        }

        .profile-container.visible {
            display: block;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: bold;
            margin: 0 auto 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .profile-username {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-fullname {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 16px;
            margin-bottom: 16px;
        }

        .profile-stats-row {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 24px;
        }

        .profile-stat-item {
            text-align: center;
        }

        .profile-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .profile-stat-label {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999999);
        }

        .profile-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Animations */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
            }
        }

        /* Confetti animation */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
            display: none;
        }

        .confetti-container.active {
            display: block;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f44336;
            opacity: 0.8;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus styles for keyboard navigation */
        button:focus-visible,
        input:focus-visible,
        .cell:focus-visible,
        .tab:focus-visible,
        .nav-item:focus-visible,
        .rps-choice:focus-visible {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Debug panel for development */
        .debug-panel {
            position: fixed;
            bottom: 70px; /* Adjusted to be above bottom navigation */
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            font-size: 12px;
            max-height: 100px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .debug-panel.visible {
            display: block;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --secondary-color: #2a2a2a;
            }

            .difficulty-btn {
                background-color: #333;
            }

            .tab.active {
                background-color: #333;
            }

            .history-item {
                background-color: #333;
            }

            .game-card {
                background-color: #333;
            }

            .notification-item {
                background-color: #333;
            }
        }

        /* Responsive adjustments */
        @media (max-width: 400px) {
            .container {
                padding: 12px;
            }

            .header h1 {
                font-size: 24px;
            }

            .cell {
                font-size: 40px;
            }

            .profile-avatar {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .profile-name {
                font-size: 16px;
            }

            .profile-stats {
                font-size: 12px;
            }

            .rps-choice i {
                font-size: 36px;
            }
        }

        /* Dashboard Styles */
        .welcome-banner {
            background: linear-gradient(135deg, var(--primary-color), #2678b6);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            color: white;
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .welcome-content h2 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .welcome-content p {
            margin-bottom: 20px;
            font-size: 16px;
            opacity: 0.9;
        }

        .welcome-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .welcome-btn {
            padding: 12px 24px;
            background-color: white;
            color: var(--primary-color);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            text-decoration: none;
        }

        .welcome-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .welcome-btn.secondary {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        .games-showcase {
            margin-bottom: 24px;
        }

        .game-cards {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .game-showcase-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-speed) ease;
        }

        .game-showcase-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }

        .game-number {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
        }

        .game-showcase-icon {
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .game-showcase-content {
            flex: 1;
        }

        .game-showcase-content h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .game-showcase-content p {
            color: var(--tg-theme-hint-color, #999999);
            margin-bottom: 12px;
            font-size: 14px;
        }

        .game-showcase-btn {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .game-showcase-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .features-section {
            margin-bottom: 24px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .feature-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: flex-start;
            gap: 16px;
            transition: all var(--transition-speed) ease;
        }

        .feature-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            width: 50px;
            height: 50px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .feature-content {
            flex: 1;
        }

        .feature-content h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feature-content p {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 14px;
        }

        .how-to-play-section {
            margin-bottom: 24px;
        }

        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .step-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: flex-start;
            gap: 16px;
            transition: all var(--transition-speed) ease;
        }

        .step-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .step-number {
            width: 36px;
            height: 36px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step-content p {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 14px;
        }

        .pro-tip-section {
            background-color: #FFF8E1;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            border-left: 4px solid #FFC107;
        }

        .pro-tip-icon {
            width: 50px;
            height: 50px;
            background-color: #FFC107;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            flex-shrink: 0;
        }

        .pro-tip-content h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #F57C00;
        }

        .pro-tip-content p {
            font-size: 16px;
            color: #5D4037;
        }

        .profile-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .recent-activity-section {
            margin-bottom: 24px;
        }

        /* Dark mode adjustments */
        @media (prefers-color-scheme: dark) {
            .game-showcase-card,
            .feature-card,
            .step-card,
            .profile-card {
                background-color: #333;
            }

            .pro-tip-section {
                background-color: #3E2723;
                border-left: 4px solid #FFC107;
            }

            .pro-tip-content h4 {
                color: #FFC107;
            }

            .pro-tip-content p {
                color: #E0E0E0;
            }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .welcome-content h2 {
                font-size: 20px;
            }

            .welcome-content p {
                font-size: 14px;
            }

            .welcome-btn {
                padding: 10px 16px;
                font-size: 14px;
            }

            .features-grid,
            .steps-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="section-container visible">
    <div class="header">
        <h1>Game Hub Pro</h1>
        <div class="badge">OFFICIAL</div>
        <div class="version">v2.0.0</div>
    </div>

    <div class="error-message" id="errorMessage"></div>
    <div class="success-message" id="successMessage"></div>

    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <div class="welcome-content">
            <h2>Welcome to Game Hub Pro!</h2>
            <p>Play classic games, challenge friends, and climb the leaderboard!</p>
            <div class="welcome-buttons">
                <button class="welcome-btn" id="playNowBtn">
                    <i class="fas fa-gamepad"></i> Play Now
                </button>
                <a href="https://t.me/AbroTemTechnologies" class="welcome-btn secondary" target="_blank">
                    <i class="fas fa-bullhorn"></i> Join Official Channel
                </a>
            </div>
        </div>
    </div>

    <!-- Games Showcase -->
    <div class="games-showcase">
        <h3 class="section-title"><i class="fas fa-gamepad"></i> Our Games</h3>
        
        <div class="game-cards">
            <div class="game-showcase-card" id="tttShowcaseCard">
                <div class="game-number">1️⃣</div>
                <div class="game-showcase-icon">
                    <i class="fas fa-th"></i>
                </div>
                <div class="game-showcase-content">
                    <h4>TIC-TAC-TOE ❌⭕</h4>
                    <p>Classic game of X's and O's with multiple difficulty levels!</p>
                    <button class="game-showcase-btn" id="playTTTBtn">
                        <i class="fas fa-play"></i> Play Now
                    </button>
                </div>
            </div>
            
            <div class="game-showcase-card" id="rpsShowcaseCard">
                <div class="game-number">2️⃣</div>
                <div class="game-showcase-icon">
                    <i class="fas fa-hand-rock"></i>
                </div>
                <div class="game-showcase-content">
                    <h4>ROCK-PAPER-SCISSORS ✊✋✌️</h4>
                    <p>Test your luck and strategy in this classic hand game!</p>
                    <button class="game-showcase-btn" id="playRPSBtn">
                        <i class="fas fa-play"></i> Play Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="features-section">
        <h3 class="section-title"><i class="fas fa-star"></i> Features</h3>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="feature-content">
                    <h4>Play vs AI 🤖</h4>
                    <p>Challenge our AI with multiple difficulty levels to test your skills!</p>
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-user-friends"></i>
                </div>
                <div class="feature-content">
                    <h4>Play with Friends 👥</h4>
                    <p>Create a game and share the code with friends to play together!</p>
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="feature-content">
                    <h4>Leaderboard 🏆</h4>
                    <p>Win games to climb the global leaderboard and become #1!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- How to Play Section -->
    <div class="how-to-play-section">
        <h3 class="section-title"><i class="fas fa-question-circle"></i> How to Play</h3>
        
        <div class="steps-container">
            <div class="step-card">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Start the bot</h4>
                    <p>Use the /start command in Telegram to initialize the bot</p>
                </div>
            </div>
            
            <div class="step-card">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Open Web App</h4>
                    <p>Click on the "Play Games" button in the Telegram bot</p>
                </div>
            </div>
            
            <div class="step-card">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Choose a game</h4>
                    <p>Select Tic-Tac-Toe or Rock-Paper-Scissors from the Games tab</p>
                </div>
            </div>
            
            <div class="step-card">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Select mode</h4>
                    <p>Choose AI mode to play against the bot or Friend mode to play multiplayer</p>
                </div>
            </div>
            
            <div class="step-card">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>For multiplayer games:</h4>
                    <p>Click "Create New Game" to get a game code, then share it with your friend</p>
                </div>
            </div>
            
            <div class="step-card">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h4>To join a game:</h4>
                    <p>Enter the 6-character game code and click "Join Game"</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pro Tip Section -->
    <div class="pro-tip-section">
        <div class="pro-tip-icon">
            <i class="fas fa-lightbulb"></i>
        </div>
        <div class="pro-tip-content">
            <h4>🔥 Pro Tip:</h4>
            <p>Play against the AI to dominate the leaderboard! Can you reach #1?</p>
        </div>
    </div>

    <!-- No profile section here, it's in the dedicated profile tab -->

    <!-- Recent Activity Section -->
    <div class="recent-activity-section">
        <h3 class="section-title"><i class="fas fa-history"></i> Recent Activity</h3>
        <div id="dashboardHistoryLoading" class="loading">
            <div class="spinner"></div>
            <p>Loading recent games...</p>
        </div>
        <ul class="history-list" id="dashboardHistoryList"></ul>
    </div>
</div>

        <!-- Games Section -->
        <div id="gamesSection" class="section-container game-selection">
            <div class="header">
                <h1>Games</h1>
                <div class="badge">PLAY</div>
                <div class="version">v2.0.0</div>
            </div>

            <div class="game-card" id="tttGameCard">
                <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/Untitled%20design-zWkSmusLor0HbN7WC22GkxIvaJYkes.png" alt="TicTacToe Game" class="game-card-image">
                <div class="game-card-content">
                    <div class="game-card-title">
                        <i class="fas fa-th"></i> TicTacToe Pro
                    </div>
                    <div class="game-card-description">
                        Classic game of X's and O's with AI and multiplayer modes.
                    </div>
                    <div class="game-card-stats">
                        <span><i class="fas fa-trophy"></i> <span id="tttCardWins">0</span> Wins</span>
                        <span><i class="fas fa-gamepad"></i> <span id="tttCardGames">0</span> Games</span>
                    </div>
                </div>
            </div>

            <div class="game-card" id="rpsGameCard">
                <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/Untitled%20design-i8JMGvQ3fJGs7fNVHSPsy2KaIcdyee.png" alt="Rock Paper Scissors Game" class="game-card-image">
                <div class="game-card-content">
                    <div class="game-card-title">
                        <i class="fas fa-hand-rock"></i> Rock Paper Scissors
                    </div>
                    <div class="game-card-description">
                        Test your luck and strategy in this classic hand game.
                    </div>
                    <div class="game-card-stats">
                        <span><i class="fas fa-trophy"></i> <span id="rpsCardWins">0</span> Wins</span>
                        <span><i class="fas fa-gamepad"></i> <span id="rpsCardGames">0</span> Games</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- TicTacToe Game Section -->
        <div id="tttGameSection" class="section-container">
            <div class="header">
                <h1>TicTacToe Pro</h1>
                <div class="badge">GAME</div>
                <div class="version">v2.0.0</div>
            </div>

            <div class="game-modes">
                <button class="mode-btn active" id="aiMode" aria-label="Play with AI">
                    <i class="fas fa-robot"></i> Play with AI
                </button>
                <button class="mode-btn" id="friendMode" aria-label="Play with Friend">
                    <i class="fas fa-user-friends"></i> Play with Friend
                </button>
            </div>

            <div class="difficulty-selector" id="difficultySelector">
                <h3>Select Difficulty</h3>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn" data-difficulty="easy" aria-label="Easy difficulty">Easy</button>
                    <button class="difficulty-btn active" data-difficulty="medium" aria-label="Medium difficulty">Medium</button>
                    <button class="difficulty-btn" data-difficulty="hard" aria-label="Hard difficulty">Hard</button>
                </div>
            </div>

            <div class="game-id-container" id="gameIdContainer">
                <h3>Multiplayer Game</h3>
                <input type="text" class="game-id-input" id="gameIdInput" placeholder="Enter Game ID" maxlength="6" aria-label="Game ID input">
                <button class="game-id-btn" id="joinGameBtn" aria-label="Join Game">
                    <i class="fas fa-sign-in-alt"></i> Join Game
                </button>
                <button class="game-id-btn" id="createGameBtn" aria-label="Create New Game">
                    <i class="fas fa-plus-circle"></i> Create New Game
                </button>
                <div class="game-id-display" id="gameIdDisplay"></div>
            </div>

            <div class="status" id="status">X's turn</div>

            <div class="board-container">
                <div class="board" id="board">
                    <div class="cell" data-index="0" tabindex="0" role="button" aria-label="Cell 1, empty"></div>
                    <div class="cell" data-index="1" tabindex="0" role="button" aria-label="Cell 2, empty"></div>
                    <div class="cell" data-index="2" tabindex="0" role="button" aria-label="Cell 3, empty"></div>
                    <div class="cell" data-index="3" tabindex="0" role="button" aria-label="Cell 4, empty"></div>
                    <div class="cell" data-index="4" tabindex="0" role="button" aria-label="Cell 5, empty"></div>
                    <div class="cell" data-index="5" tabindex="0" role="button" aria-label="Cell 6, empty"></div>
                    <div class="cell" data-index="6" tabindex="0" role="button" aria-label="Cell 7, empty"></div>
                    <div class="cell" data-index="7" tabindex="0" role="button" aria-label="Cell 8, empty"></div>
                    <div class="cell" data-index="8" tabindex="0" role="button" aria-label="Cell 9, empty"></div>
                </div>
            </div>

            <div class="actions">
                <button class="action-btn secondary" id="resetBtn" aria-label="Reset Game">
                    <i class="fas fa-redo"></i> Reset
                </button>
                <button class="action-btn" id="shareBtn" aria-label="Share Game">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>

        <!-- Rock Paper Scissors Game Section -->
        <div id="rpsGameSection" class="section-container rps-container">
            <div class="header">
                <h1>Rock Paper Scissors</h1>
                <div class="badge">GAME</div>
                <div class="version">v2.0.0</div>
            </div>

            <div class="game-modes">
                <button class="mode-btn active" id="rpsAiMode" aria-label="Play with AI">
                    <i class="fas fa-robot"></i> Play with AI
                </button>
                <button class="mode-btn" id="rpsFriendMode" aria-label="Play with Friend">
                    <i class="fas fa-user-friends"></i> Play with Friend
                </button>
            </div>

            <div class="difficulty-selector" id="rpsDifficultySelector">
                <h3>Select Difficulty</h3>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn" data-difficulty="easy" aria-label="Easy difficulty">Easy</button>
                    <button class="difficulty-btn active" data-difficulty="medium" aria-label="Medium difficulty">Medium</button>
                    <button class="difficulty-btn" data-difficulty="hard" aria-label="Hard difficulty">Hard</button>
                </div>
            </div>

            <div class="game-id-container" id="rpsGameIdContainer">
                <h3>Multiplayer Game</h3>
                <input type="text" class="game-id-input" id="rpsGameIdInput" placeholder="Enter Game ID" maxlength="6" aria-label="Game ID input">
                <button class="game-id-btn" id="rpsJoinGameBtn" aria-label="Join Game">
                    <i class="fas fa-sign-in-alt"></i> Join Game
                </button>
                <button class="game-id-btn" id="rpsCreateGameBtn" aria-label="Create New Game">
                    <i class="fas fa-plus-circle"></i> Create New Game
                </button>
                <div class="game-id-display" id="rpsGameIdDisplay"></div>
            </div>

            <div class="status" id="rpsStatus">Choose your move</div>

            <div class="rps-choices" id="rpsChoices">
                <div class="rps-choice" data-choice="rock" tabindex="0" role="button" aria-label="Choose Rock">
                    <i class="fas fa-hand-rock"></i>
                </div>
                <div class="rps-choice" data-choice="paper" tabindex="0" role="button" aria-label="Choose Paper">
                    <i class="fas fa-hand-paper"></i>
                </div>
                <div class="rps-choice" data-choice="scissors" tabindex="0" role="button" aria-label="Choose Scissors">
                    <i class="fas fa-hand-scissors"></i>
                </div>
            </div>

            <div class="rps-result" id="rpsResult">
                <div class="rps-player">
                    <div class="rps-choice-display" id="playerChoiceDisplay">
                        <i class="fas fa-question"></i>
                    </div>
                    <div class="rps-choice-label">You</div>
                </div>
                <div class="rps-vs">VS</div>
                <div class="rps-computer">
                    <div class="rps-choice-display" id="computerChoiceDisplay">
                        <i class="fas fa-question"></i>
                    </div>
                    <div class="rps-choice-label">Opponent</div>
                </div>
            </div>

            <div class="actions">
                <button class="action-btn secondary" id="rpsResetBtn" aria-label="Play Again">
                    <i class="fas fa-redo"></i> Play Again
                </button>
                <button class="action-btn" id="rpsShareBtn" aria-label="Share Game">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div id="leaderboardSection" class="section-container">
            <div class="header">
                <h1>Leaderboard</h1>
                <div class="badge">TOP</div>
                <div class="version">v2.0.0</div>
            </div>

            <div class="tabs">
                <div class="tab active" id="allLeaderboardTab" role="tab" aria-selected="true" tabindex="0">
                    <i class="fas fa-trophy"></i> All
                </div>
                <div class="tab" id="tttLeaderboardTab" role="tab" aria-selected="false" tabindex="0">
                    <i class="fas fa-th"></i> TTT
                </div>
                <div class="tab" id="rpsLeaderboardTab" role="tab" aria-selected="false" tabindex="0">
                    <i class="fas fa-hand-rock"></i> RPS
                </div>
            </div>

            <div class="tab-content active" id="allLeaderboardContent" role="tabpanel" aria-labelledby="allLeaderboardTab">
                <div class="leaderboard">
                    <h2><i class="fas fa-trophy"></i> Top Players</h2>
                    <div id="allLeaderboardLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Loading leaderboard...</p>
                    </div>
                    <ul class="leaderboard-list" id="allLeaderboardList"></ul>
                </div>
            </div>

            <div class="tab-content" id="tttLeaderboardContent" role="tabpanel" aria-labelledby="tttLeaderboardTab">
                <div class="leaderboard">
                    <h2><i class="fas fa-th"></i> TicTacToe Leaderboard</h2>
                    <div id="tttLeaderboardLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Loading leaderboard...</p>
                    </div>
                    <ul class="leaderboard-list" id="tttLeaderboardList"></ul>
                </div>
            </div>

            <div class="tab-content" id="rpsLeaderboardContent" role="tabpanel" aria-labelledby="rpsLeaderboardTab">
                <div class="leaderboard">
                    <h2><i class="fas fa-hand-rock"></i> RPS Leaderboard</h2>
                    <div id="rpsLeaderboardLoading" class="loading">
                        <div class="spinner"></div>
                        <p>Loading leaderboard...</p>
                    </div>
                    <ul class="leaderboard-list" id="rpsLeaderboardList"></ul>
                </div>
            </div>
        </div>

        <!-- Notifications Section -->
        <div id="notificationsSection" class="section-container notifications-container">
            <div class="header">
                <h1>Notifications</h1>
                <div class="badge">NEW</div>
                <div class="version">v2.0.0</div>
            </div>

            <div id="notificationsLoading" class="loading">
                <div class="spinner"></div>
                <p>Loading notifications...</p>
            </div>

            <div id="notificationsList">
                <!-- Notifications will be loaded here -->
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="section-container profile-container">
            <div class="header">
                <h1>Profile</h1>
                <div class="badge">YOU</div>
                <div class="version">v2.0.0</div>
            </div>

            <div class="profile-header">
                <div class="profile-avatar-large" id="profileAvatarLarge">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-username" id="profileUsername">@username</div>
                <div class="profile-fullname" id="profileFullname">Player Name</div>
            </div>

            <div class="profile-stats-row">
                <div class="profile-stat-item">
                    <div class="profile-stat-value" id="profileTotalWins">0</div>
                    <div class="profile-stat-label">Wins</div>
                </div>
                <div class="profile-stat-item">
                    <div class="profile-stat-value" id="profileTotalGames">0</div>
                    <div class="profile-stat-label">Games</div>
                </div>
                <div class="profile-stat-item">
                    <div class="profile-stat-value" id="profileWinRate">0%</div>
                    <div class="profile-stat-label">Win Rate</div>
                </div>
            </div>

            <div class="profile-section-title">
                <i class="fas fa-history"></i> Recent Games
            </div>

            <div id="profileHistoryLoading" class="loading">
                <div class="spinner"></div>
                <p>Loading game history...</p>
            </div>
            <ul class="history-list" id="profileHistoryList"></ul>
        </div>
    </div>

    <div class="connection-status" id="connectionStatus">
        <i class="fas fa-circle"></i>
        <span>Connecting...</span>
    </div>

    <div class="confetti-container" id="confettiContainer"></div>
    <div class="debug-panel" id="debugPanel"></div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" id="dashboardNav" data-section="dashboardSection">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </div>
        <div class="nav-item" id="gamesNav" data-section="gamesSection">
            <i class="fas fa-gamepad"></i>
            <span>Games</span>
        </div>
        <div class="nav-item" id="leaderboardNav" data-section="leaderboardSection">
            <i class="fas fa-trophy"></i>
            <span>Leaderboard</span>
        </div>
        <div class="nav-item" id="notificationsNav" data-section="notificationsSection">
            <i class="fas fa-bell"></i>
            <span>Notifications</span>
        </div>
        <div class="nav-item" id="profileNav" data-section="profileSection">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tgApp = window.Telegram.WebApp;
        tgApp.expand();
        tgApp.ready();

        // Debug function
        function debug(message) {
            const debugPanel = document.getElementById('debugPanel');
            const timestamp = new Date().toLocaleTimeString();
            debugPanel.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugPanel.scrollTop = debugPanel.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }

        // Show error message
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            errorMessage.classList.add('visible');
            setTimeout(() => {
                errorMessage.classList.remove('visible');
            }, 5000);
        }

        // Show success message
        function showSuccess(message) {
            const successMessage = document.getElementById('successMessage');
            successMessage.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            successMessage.classList.add('visible');
            setTimeout(() => {
                successMessage.classList.remove('visible');
            }, 5000);
        }

        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDQnxnxCvEMXH-kQE_Jy-P0qGwk-Zd4kXA",
            authDomain: "telegrambot-b8015.firebaseapp.com",
            databaseURL: "https://telegrambot-b8015-default-rtdb.firebaseio.com",
            projectId: "telegrambot-b8015",
            storageBucket: "telegrambot-b8015.appspot.com",
            messagingSenderId: "1001462001233",
            appId: "1:1001462001233:web:c9e8c9e1c9a1b1b1b1b1b1"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            debug("Firebase initialized successfully");
        } catch (error) {
            debug("Firebase initialization error: " + error.message);
            showError("Failed to initialize Firebase. Please try again.");
        }

        // Get database reference
        const db = firebase.database();

        // Check connection status
        const connectedRef = db.ref(".info/connected");
        connectedRef.on("value", (snap) => {
            const connectionStatus = document.getElementById("connectionStatus");
            if (snap.val() === true) {
                connectionStatus.classList.add("online");
                connectionStatus.classList.remove("offline");
                connectionStatus.innerHTML = '<i class="fas fa-circle"></i><span>Online</span>';
                debug("Connected to Firebase");
            } else {
                connectionStatus.classList.remove("online");
                connectionStatus.classList.add("offline");
                connectionStatus.innerHTML = '<i class="fas fa-circle"></i><span>Offline</span>';
                debug("Disconnected from Firebase");
            }
        });

        // Game state
        let gameState = {
            board: ["", "", "", "", "", "", "", "", ""],
            currentPlayer: "X",
            gameMode: "ai",
            difficulty: "medium",
            gameId: null,
            status: "playing",
            playerSymbol: "X",
            opponentSymbol: "O",
            playerName: "Player",
            playerStats: {
                wins: 0,
                games: 0,
                winRate: 0,
                tttWins: 0,
                tttGames: 0,
                rpsWins: 0,
                rpsGames: 0
            }
        };

        // RPS Game state
        let rpsGameState = {
            gameMode: "ai",
            difficulty: "medium",
            gameId: null,
            status: "playing",
            playerChoice: null,
            opponentChoice: null,
            result: null
        };

        // Navigation state
        let currentSection = "dashboardSection";

        // DOM elements
        const boardElement = document.getElementById("board");
        const statusElement = document.getElementById("status");
        const resetButton = document.getElementById("resetBtn");
        const shareButton = document.getElementById("shareBtn");
        const aiModeButton = document.getElementById("aiMode");
        const friendModeButton = document.getElementById("friendMode");
        const difficultySelectorElement = document.getElementById("difficultySelector");
        const gameIdContainerElement = document.getElementById("gameIdContainer");
        const gameIdInputElement = document.getElementById("gameIdInput");
        const gameIdDisplayElement = document.getElementById("gameIdDisplay");
        const joinGameButton = document.getElementById("joinGameBtn");
        const createGameButton = document.getElementById("createGameBtn");
        const difficultyButtons = document.querySelectorAll(".difficulty-btn");
        
        // RPS DOM elements
        const rpsStatusElement = document.getElementById("rpsStatus");
        const rpsChoicesElement = document.getElementById("rpsChoices");
        const playerChoiceDisplayElement = document.getElementById("playerChoiceDisplay");
        const computerChoiceDisplayElement = document.getElementById("computerChoiceDisplay");
        const rpsResetButton = document.getElementById("rpsResetBtn");
        const rpsShareButton = document.getElementById("rpsShareBtn");
        const rpsAiModeButton = document.getElementById("rpsAiMode");
        const rpsFriendModeButton = document.getElementById("rpsFriendMode");
        const rpsDifficultySelectorElement = document.getElementById("rpsDifficultySelector");
        const rpsGameIdContainerElement = document.getElementById("rpsGameIdContainer");
        const rpsGameIdInputElement = document.getElementById("rpsGameIdInput");
        const rpsGameIdDisplayElement = document.getElementById("rpsGameIdDisplay");
        const rpsJoinGameButton = document.getElementById("rpsJoinGameBtn");
        const rpsCreateGameButton = document.getElementById("rpsCreateGameBtn");
        const rpsDifficultyButtons = document.querySelectorAll("#rpsDifficultySelector .difficulty-btn");
        
        // Leaderboard DOM elements
        const allLeaderboardListElement = document.getElementById("allLeaderboardList");
        const tttLeaderboardListElement = document.getElementById("tttLeaderboardList");
        const rpsLeaderboardListElement = document.getElementById("rpsLeaderboardList");
        const allLeaderboardLoadingElement = document.getElementById("allLeaderboardLoading");
        const tttLeaderboardLoadingElement = document.getElementById("tttLeaderboardLoading");
        const rpsLeaderboardLoadingElement = document.getElementById("rpsLeaderboardLoading");
        
        // Navigation DOM elements
        const navItems = document.querySelectorAll(".nav-item");
        const sectionContainers = document.querySelectorAll(".section-container");
        
        // Game cards
        const tttGameCard = document.getElementById("tttGameCard");
        const rpsGameCard = document.getElementById("rpsGameCard");
        
        // Leaderboard tabs
        const allLeaderboardTab = document.getElementById("allLeaderboardTab");
        const tttLeaderboardTab = document.getElementById("tttLeaderboardTab");
        const rpsLeaderboardTab = document.getElementById("rpsLeaderboardTab");
        const allLeaderboardContent = document.getElementById("allLeaderboardContent");
        const tttLeaderboardContent = document.getElementById("tttLeaderboardContent");
        const rpsLeaderboardContent = document.getElementById("rpsLeaderboardContent");
        
        // Dashboard tabs
        const recentGamesTab = document.getElementById("recentGamesTab");
        const statsTab = document.getElementById("statsTab");
        const recentGamesContent = document.getElementById("recentGamesContent");
        const statsContent = document.getElementById("statsContent");
        
        // Profile elements
        const profileNameElement = document.getElementById("profileName");
        const profileAvatarElement = document.getElementById("profileAvatar");
        const profileAvatarLargeElement = document.getElementById("profileAvatarLarge");
        const profileUsernameElement = document.getElementById("profileUsername");
        const profileFullnameElement = document.getElementById("profileFullname");
        const profileTotalWinsElement = document.getElementById("profileTotalWins");
        const profileTotalGamesElement = document.getElementById("profileTotalGames");
        const profileWinRateElement = document.getElementById("profileWinRate");
        const profileHistoryListElement = document.getElementById("profileHistoryList");
        const profileHistoryLoadingElement = document.getElementById("profileHistoryLoading");
        
        // Stats elements
        const statWinsElement = document.getElementById("statWins");
        const statGamesElement = document.getElementById("statGames");
        const statWinRateElement = document.getElementById("statWinRate");
        const tttWinsElement = document.getElementById("tttWins");
        const rpsWinsElement = document.getElementById("rpsWins");
        const totalGamesElement = document.getElementById("totalGames");
        const overallWinRateElement = document.getElementById("overallWinRate");
        const tttCardWinsElement = document.getElementById("tttCardWins");
        const tttCardGamesElement = document.getElementById("tttCardGames");
        const rpsCardWinsElement = document.getElementById("rpsCardWins");
        const rpsCardGamesElement = document.getElementById("rpsCardGames");
        
        // Notifications elements
        const notificationsListElement = document.getElementById("notificationsList");
        const notificationsLoadingElement = document.getElementById("notificationsLoading");
        
        // Dashboard history elements
        const dashboardHistoryListElement = document.getElementById("dashboardHistoryList");
        const dashboardHistoryLoadingElement = document.getElementById("dashboardHistoryLoading");
        
        // Initialize profile
        function initializeProfile() {
            // Try to get user data from Telegram
            if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                const user = tgApp.initDataUnsafe.user;
                gameState.playerName = user.first_name || "Player";
                
                // Update profile UI
                profileNameElement.textContent = gameState.playerName;
                profileFullnameElement.textContent = gameState.playerName;
                profileUsernameElement.textContent = user.username ? `@${user.username}` : "";
                
                // If user has initials, show them in avatar
                if (gameState.playerName) {
                    const initials = gameState.playerName.charAt(0).toUpperCase();
                    profileAvatarElement.innerHTML = initials;
                    profileAvatarLargeElement.innerHTML = initials;
                }
                
                // Load player stats from Firebase
                loadPlayerStats(user.id);
            } else {
                // Fallback for testing in browser
                debug("No Telegram user data available, using default profile");
            }
        }

        // Load player stats from Firebase
        function loadPlayerStats(userId) {
            if (!userId) return;
            
            const userRef = db.ref(`users/${userId}`);
            userRef.once("value").then(snapshot => {
                const userData = snapshot.val();
                
                if (userData) {
                    gameState.playerStats.wins = userData.wins || 0;
                    gameState.playerStats.games = userData.games || 0;
                    gameState.playerStats.tttWins = userData.tttWins || 0;
                    gameState.playerStats.tttGames = userData.tttGames || 0;
                    gameState.playerStats.rpsWins = userData.rpsWins || 0;
                    gameState.playerStats.rpsGames = userData.rpsGames || 0;
                    gameState.playerStats.winRate = userData.games > 0 
                        ? Math.round((userData.wins / userData.games) * 100) 
                        : 0;
                    
                    // Update stats UI
                    updateStatsUI();
                }
            }).catch(error => {
                debug(`Error loading player stats: ${error.message}`);
            });
        }

        // Update stats UI
        function updateStatsUI() {
            statWinsElement.textContent = gameState.playerStats.wins;
            statGamesElement.textContent = gameState.playerStats.games;
            statWinRateElement.textContent = `${gameState.playerStats.winRate}%`;
            
            // Update detailed stats
            tttWinsElement.textContent = gameState.playerStats.tttWins;
            rpsWinsElement.textContent = gameState.playerStats.rpsWins;
            totalGamesElement.textContent = gameState.playerStats.games;
            overallWinRateElement.textContent = `${gameState.playerStats.winRate}%`;
            
            // Update game cards
            tttCardWinsElement.textContent = gameState.playerStats.tttWins;
            tttCardGamesElement.textContent = gameState.playerStats.tttGames;
            rpsCardWinsElement.textContent = gameState.playerStats.rpsWins;
            rpsCardGamesElement.textContent = gameState.playerStats.rpsGames;
            
            // Update profile stats
            profileTotalWinsElement.textContent = gameState.playerStats.wins;
            profileTotalGamesElement.textContent = gameState.playerStats.games;
            profileWinRateElement.textContent = `${gameState.playerStats.winRate}%`;
        }

        // Check for game ID in URL
        const urlParams = new URLSearchParams(window.location.search);
        const gameIdFromUrl = urlParams.get("gameId");
        const gameTypeFromUrl = urlParams.get("gameType");

        if (gameIdFromUrl) {
            debug(`Game ID found in URL: ${gameIdFromUrl}, type: ${gameTypeFromUrl || 'ttt'}`);
            
            if (gameTypeFromUrl === 'rps') {
                // Switch to RPS game
                switchSection('rpsGameSection');
                rpsGameState.gameMode = "friend";
                rpsGameState.gameId = gameIdFromUrl;
                updateRpsGameModeUI();
                joinRpsGame(gameIdFromUrl);
            } else {
                // Default to TicTacToe
                switchSection('tttGameSection');
                gameState.gameMode = "friend";
                gameState.gameId = gameIdFromUrl;
                updateGameModeUI();
                joinGame(gameIdFromUrl);
            }
        } else {
            debug("No game ID found in URL, starting in dashboard mode");
            switchSection('dashboardSection');
        }

        // Initialize profile
        initializeProfile();

        // Load initial data
        loadLeaderboard();
        loadGameHistory();
        loadNotifications();

        // Event listeners for navigation
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const sectionId = item.dataset.section;
                switchSection(sectionId);
                
                // If switching to games section, show game selection
                if (sectionId === 'gamesSection') {
                    document.getElementById('gamesSection').classList.add('visible');
                }
            });
        });

        // Event listeners for game cards
        tttGameCard.addEventListener('click', () => {
            switchSection('tttGameSection');
        });

        rpsGameCard.addEventListener('click', () => {
            switchSection('rpsGameSection');
        });

        // Event listeners for TicTacToe
        boardElement.addEventListener("click", handleCellClick);
        boardElement.addEventListener("keydown", handleCellKeydown);
        resetButton.addEventListener("click", resetGame);
        shareButton.addEventListener("click", shareGame);
        aiModeButton.addEventListener("click", () => setGameMode("ai"));
        friendModeButton.addEventListener("click", () => setGameMode("friend"));
        joinGameButton.addEventListener("click", () => joinGame(gameIdInputElement.value));
        createGameButton.addEventListener("click", createNewGame);

        // Event listeners for RPS
        rpsChoicesElement.addEventListener("click", handleRpsChoice);
        rpsResetButton.addEventListener("click", resetRpsGame);
        rpsShareButton.addEventListener("click", shareRpsGame);
        rpsAiModeButton.addEventListener("click", () => setRpsGameMode("ai"));
        rpsFriendModeButton.addEventListener("click", () => setRpsGameMode("friend"));
        rpsJoinGameButton.addEventListener("click", () => joinRpsGame(rpsGameIdInputElement.value));
        rpsCreateGameButton.addEventListener("click", createNewRpsGame);

        // Event listeners for leaderboard tabs
        allLeaderboardTab.addEventListener("click", () => switchLeaderboardTab("all"));
        tttLeaderboardTab.addEventListener("click", () => switchLeaderboardTab("ttt"));
        rpsLeaderboardTab.addEventListener("click", () => switchLeaderboardTab("rps"));

        // Event listeners for dashboard tabs
        recentGamesTab.addEventListener("click", () => switchDashboardTab("recentGames"));
        statsTab.addEventListener("click", () => switchDashboardTab("stats"));

        // Keyboard navigation for tabs
        allLeaderboardTab.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                switchLeaderboardTab("all");
            }
        });
        
        tttLeaderboardTab.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                switchLeaderboardTab("ttt");
            }
        });
        
        rpsLeaderboardTab.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                switchLeaderboardTab("rps");
            }
        });

        difficultyButtons.forEach(button => {
            button.addEventListener("click", () => {
                difficultyButtons.forEach(btn => btn.classList.remove("active"));
                button.classList.add("active");
                gameState.difficulty = button.dataset.difficulty;
                resetGame();
            });
        });

        rpsDifficultyButtons.forEach(button => {
            button.addEventListener("click", () => {
                rpsDifficultyButtons.forEach(btn => btn.classList.remove("active"));
                button.classList.add("active");
                rpsGameState.difficulty = button.dataset.difficulty;
                resetRpsGame();
            });
        });

        // Functions
        function switchSection(sectionId) {
            // Hide all sections
            sectionContainers.forEach(section => {
                section.style.display = 'none';
                section.classList.remove('visible');
            });
            
            // Show selected section
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.style.display = 'block';
                setTimeout(() => {
                    selectedSection.classList.add('visible');
                }, 10);
            }
            
            // Update navigation
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionId) {
                    item.classList.add('active');
                }
            });
            
            currentSection = sectionId;
        }

        function switchLeaderboardTab(tabName) {
            if (tabName === "all") {
                allLeaderboardTab.classList.add("active");
                tttLeaderboardTab.classList.remove("active");
                rpsLeaderboardTab.classList.remove("active");
                allLeaderboardContent.classList.add("active");
                tttLeaderboardContent.classList.remove("active");
                rpsLeaderboardContent.classList.remove("active");
                allLeaderboardTab.setAttribute("aria-selected", "true");
                tttLeaderboardTab.setAttribute("aria-selected", "false");
                rpsLeaderboardTab.setAttribute("aria-selected", "false");
            } else if (tabName === "ttt") {
                allLeaderboardTab.classList.remove("active");
                tttLeaderboardTab.classList.add("active");
                rpsLeaderboardTab.classList.remove("active");
                allLeaderboardContent.classList.remove("active");
                tttLeaderboardContent.classList.add("active");
                rpsLeaderboardContent.classList.remove("active");
                allLeaderboardTab.setAttribute("aria-selected", "false");
                tttLeaderboardTab.setAttribute("aria-selected", "true");
                rpsLeaderboardTab.setAttribute("aria-selected", "false");
            } else {
                allLeaderboardTab.classList.remove("active");
                tttLeaderboardTab.classList.remove("active");
                rpsLeaderboardTab.classList.add("active");
                allLeaderboardContent.classList.remove("active");
                tttLeaderboardContent.classList.remove("active");
                rpsLeaderboardContent.classList.add("active");
                allLeaderboardTab.setAttribute("aria-selected", "false");
                tttLeaderboardTab.setAttribute("aria-selected", "false");
                rpsLeaderboardTab.setAttribute("aria-selected", "true");
            }
        }

        function switchDashboardTab(tabName) {
            if (tabName === "recentGames") {
                recentGamesTab.classList.add("active");
                statsTab.classList.remove("active");
                recentGamesContent.classList.add("active");
                statsContent.classList.remove("active");
                recentGamesTab.setAttribute("aria-selected", "true");
                statsTab.setAttribute("aria-selected", "false");
            } else {
                recentGamesTab.classList.remove("active");
                statsTab.classList.add("active");
                recentGamesContent.classList.remove("active");
                statsContent.classList.add("active");
                recentGamesTab.setAttribute("aria-selected", "false");
                statsTab.setAttribute("aria-selected", "true");
            }
        }

        function updateGameModeUI() {
            if (gameState.gameMode === "ai") {
                aiModeButton.classList.add("active");
                friendModeButton.classList.remove("active");
                difficultySelectorElement.classList.add("visible");
                gameIdContainerElement.classList.remove("visible");
            } else {
                aiModeButton.classList.remove("active");
                friendModeButton.classList.add("active");
                difficultySelectorElement.classList.remove("visible");
                gameIdContainerElement.classList.add("visible");
            }
        }

        function updateRpsGameModeUI() {
            if (rpsGameState.gameMode === "ai") {
                rpsAiModeButton.classList.add("active");
                rpsFriendModeButton.classList.remove("active");
                rpsDifficultySelectorElement.classList.add("visible");
                rpsGameIdContainerElement.classList.remove("visible");
            } else {
                rpsAiModeButton.classList.remove("active");
                rpsFriendModeButton.classList.add("active");
                rpsDifficultySelectorElement.classList.remove("visible");
                rpsGameIdContainerElement.classList.add("visible");
            }
        }

        function setGameMode(mode) {
            gameState.gameMode = mode;
            updateGameModeUI();
            resetGame();
        }

        function setRpsGameMode(mode) {
            rpsGameState.gameMode = mode;
            updateRpsGameModeUI();
            resetRpsGame();
        }

        // TicTacToe Game Functions
        function handleCellClick(event) {
            if (!event.target.classList.contains("cell")) return;
            
            const index = event.target.dataset.index;
            
            // Check if cell is already filled or game is over
            if (gameState.board[index] !== "" || gameState.status !== "playing") {
                return;
            }
            
            if (gameState.gameMode === "ai") {
                // Handle AI mode
                makeMove(index);
                
                if (gameState.status === "playing") {
                    setTimeout(() => {
                        makeAIMove();
                    }, 500);
                }
            } else if (gameState.gameMode === "friend" && gameState.gameId) {
                // Handle friend mode with Firebase
                if (gameState.currentPlayer === gameState.playerSymbol) {
                    // Update move in Firebase
                    const gameRef = db.ref(`games/${gameState.gameId}`);
                    const boardCopy = [...gameState.board];
                    boardCopy[index] = gameState.currentPlayer;
                    
                    gameRef.update({
                        board: boardCopy,
                        currentTurn: gameState.currentPlayer === "X" ? "O" : "X"
                    }).then(() => {
                        debug(`Move updated in Firebase: index ${index}, player ${gameState.currentPlayer}`);
                    }).catch(error => {
                        debug(`Error updating move: ${error.message}`);
                        showError("Failed to update move. Please try again.");
                    });
                } else {
                    showError("It's not your turn!");
                }
            } else {
                // Local play (fallback)
                makeMove(index);
            }
        }

        function handleCellKeydown(event) {
            if (!event.target.classList.contains("cell")) return;
            
            if (event.key === "Enter" || event.key === " ") {
                event.preventDefault();
                event.target.click();
            }
        }

        function makeMove(index) {
            if (gameState.board[index] !== "" || gameState.status !== "playing") {
                return false;
            }
            
            gameState.board[index] = gameState.currentPlayer;
            renderBoard();
            
            const result = checkGameResult();
            if (result.status !== "playing") {
                gameState.status = result.status;
                updateStatus();
                
                if (result.status === "win" && gameState.currentPlayer === gameState.playerSymbol) {
                    updateLeaderboard("ttt");
                    showConfetti();
                }
                
                return true;
            }
            
            gameState.currentPlayer = gameState.currentPlayer === "X" ? "O" : "X";
            updateStatus();
            return true;
        }

        function makeAIMove() {
            if (gameState.status !== "playing" || gameState.currentPlayer !== gameState.opponentSymbol) {
                return;
            }
            
            let move;
            
            switch (gameState.difficulty) {
                case "easy":
                    move = getRandomMove();
                    break;
                case "medium":
                    move = Math.random() < 0.6 ? getBestMove(2) : getRandomMove();
                    break;
                case "hard":
                    move = getBestMove(5);
                    break;
                default:
                    move = getBestMove(3);
            }
            
            if (move !== null) {
                makeMove(move);
            }
        }

        function getRandomMove() {
            const availableMoves = gameState.board
                .map((cell, index) => cell === "" ? index : null)
                .filter(index => index !== null);
                
            if (availableMoves.length === 0) {
                return null;
            }
            
            return availableMoves[Math.floor(Math.random() * availableMoves.length)];
        }

        function getBestMove(depth) {
            // Minimax algorithm for AI
            const availableMoves = gameState.board
                .map((cell, index) => cell === "" ? index : null)
                .filter(index => index !== null);
                
            if (availableMoves.length === 0) {
                return null;
            }
            
            // For simplicity in this version, just return a semi-smart move
            // Check if AI can win in one move
            for (const move of availableMoves) {
                const boardCopy = [...gameState.board];
                boardCopy[move] = gameState.opponentSymbol;
                if (checkWin(boardCopy, gameState.opponentSymbol)) {
                    return move;
                }
            }
            
            // Check if player can win in one move and block
            for (const move of availableMoves) {
                const boardCopy = [...gameState.board];
                boardCopy[move] = gameState.playerSymbol;
                if (checkWin(boardCopy, gameState.playerSymbol)) {
                    return move;
                }
            }
            
            // Take center if available
            if (gameState.board[4] === "") {
                return 4;
            }
            
            // Take corners if available
            const corners = [0, 2, 6, 8].filter(index => gameState.board[index] === "");
            if (corners.length > 0) {
                return corners[Math.floor(Math.random() * corners.length)];
            }
            
            // Take any available move
            return availableMoves[Math.floor(Math.random() * availableMoves.length)];
        }

        function checkGameResult() {
            // Check for win
            if (checkWin(gameState.board, gameState.currentPlayer)) {
                return { status: "win", winner: gameState.currentPlayer };
            }
            
            // Check for draw
            if (!gameState.board.includes("")) {
                return { status: "draw" };
            }
            
            return { status: "playing" };
        }

        function checkWin(board, player) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                [0, 4, 8], [2, 4, 6]             // Diagonals
            ];
            
            return winPatterns.some(pattern => {
                return pattern.every(index => board[index] === player);
            });
        }

        function updateStatus() {
            if (gameState.status === "win") {
                statusElement.textContent = `${gameState.currentPlayer} wins!`;
                statusElement.classList.add("win");
                
                // Highlight winning cells
                const winningPattern = findWinningPattern(gameState.board, gameState.currentPlayer);
                if (winningPattern) {
                    winningPattern.forEach(index => {
                        document.querySelector(`.cell[data-index="${index}"]`).classList.add("win");
                    });
                }
                
                // Update player stats if player won
                if (gameState.currentPlayer === gameState.playerSymbol) {
                    gameState.playerStats.wins++;
                    gameState.playerStats.games++;
                    gameState.playerStats.tttWins++;
                    gameState.playerStats.tttGames++;
                    gameState.playerStats.winRate = Math.round((gameState.playerStats.wins / gameState.playerStats.games) * 100);
                    updateStatsUI();
                    updatePlayerStatsInFirebase();
                } else if (gameState.gameMode === "ai") {
                    // Only count as a game if playing against AI
                    gameState.playerStats.games++;
                    gameState.playerStats.tttGames++;
                    gameState.playerStats.winRate = Math.round((gameState.playerStats.wins / gameState.playerStats.games) * 100);
                    updateStatsUI();
                    updatePlayerStatsInFirebase();
                }
                
                // Add to game history
                addGameToHistory(gameState.currentPlayer === gameState.playerSymbol ? "win" : "loss", "ttt");
            } else if (gameState.status === "draw") {
                statusElement.textContent = "It's a draw!";
                statusElement.classList.add("draw");
                
                // Update player stats
                if (gameState.gameMode === "ai" || 
                    (gameState.gameMode === "friend" && gameState.gameId)) {
                    gameState.playerStats.games++;
                    gameState.playerStats.tttGames++;
                    gameState.playerStats.winRate = Math.round((gameState.playerStats.wins / gameState.playerStats.games) * 100);
                    updateStatsUI();
                    updatePlayerStatsInFirebase();
                    
                    // Add to game history
                    addGameToHistory("draw", "ttt");
                }
            } else {
                statusElement.textContent = `${gameState.currentPlayer}'s turn`;
                statusElement.classList.remove("win", "draw");
            }
        }

        function findWinningPattern(board, player) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                [0, 4, 8], [2, 4, 6]             // Diagonals
            ];
            
            for (const pattern of winPatterns) {
                if (pattern.every(index => board[index] === player)) {
                    return pattern;
                }
            }
            
            return null;
        }

        function renderBoard() {
            const cells = document.querySelectorAll(".cell");
            cells.forEach((cell, index) => {
                const value = gameState.board[index];
                cell.textContent = value;
                cell.classList.remove("x", "o", "win");
                
                // Update ARIA label for accessibility
                let ariaLabel = `Cell ${parseInt(index) + 1}, `;
                if (value === "X") {
                    cell.classList.add("x");
                    ariaLabel += "X";
                } else if (value === "O") {
                    cell.classList.add("o");
                    ariaLabel += "O";
                } else {
                    ariaLabel += "empty";
                }
                cell.setAttribute("aria-label", ariaLabel);
                
                // Add animation effect
                if (value && !cell.classList.contains("animated")) {
                    cell.classList.add("animated");
                    cell.style.animation = "fadeIn 0.3s";
                    setTimeout(() => {
                        cell.style.animation = "";
                    }, 300);
                }
            });
        }

        function resetGame() {
            gameState.board = ["", "", "", "", "", "", "", "", ""];
            gameState.currentPlayer = "X";
            gameState.status = "playing";
            gameState.playerSymbol = "X";
            gameState.opponentSymbol = "O";
            
            // Remove winning highlights
            document.querySelectorAll(".cell.win").forEach(cell => {
                cell.classList.remove("win");
            });
            
            statusElement.classList.remove("win", "draw");
            
            if (gameState.gameMode === "friend" && gameState.gameId) {
                // Reset game in Firebase
                const gameRef = db.ref(`games/${gameState.gameId}`);
                gameRef.update({
                    board: gameState.board,
                    currentTurn: "X",
                    status: "playing"
                }).then(() => {
                    showSuccess("Game reset successfully!");
                }).catch(error => {
                    debug(`Error resetting game: ${error.message}`);
                    showError("Failed to reset game. Please try again.");
                });
            }
            
            renderBoard();
            updateStatus();
            
            // Add board flip animation
            boardElement.classList.add("flip");
            setTimeout(() => {
                boardElement.classList.remove("flip");
            }, 500);
        }

        function createNewGame() {
            debug("Creating new game...");
            
            // Generate a random game ID (6 characters)
            const gameId = Math.random().toString(36).substring(2, 8).toUpperCase();
            gameState.gameId = gameId;
            gameState.playerSymbol = "X";
            gameState.opponentSymbol = "O";
            
            // Create game in Firebase
            const gameRef = db.ref(`games/${gameId}`);
            gameRef.set({
                id: gameId,
                board: ["", "", "", "", "", "", "", "", ""],
                currentTurn: "X",
                status: "waiting",
                gameType: "ttt",
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                expiryTime: Date.now() + (30 * 60 * 1000), // 30 minutes expiry
                createdBy: tgApp.initDataUnsafe && tgApp.initDataUnsafe.user ? tgApp.initDataUnsafe.user.id : null,
                creatorName: gameState.playerName
            }).then(() => {
                debug(`Game created with ID: ${gameId}`);
                gameIdInputElement.value = gameId;
                gameIdDisplayElement.textContent = gameId;
                gameIdDisplayElement.classList.add("visible");
                
                // Listen for game updates
                listenToGameUpdates(gameId);
                
                // Share game ID with Telegram
                if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                    tgApp.sendData(JSON.stringify({
                        type: "share_game",
                        game_id: gameId,
                        game_type: "ttt"
                    }));
                }
                
                showSuccess(`Game created! ID: ${gameId}`);
            }).catch(error => {
                debug(`Error creating game: ${error.message}`);
                showError("Failed to create game. Please try again.");
            });
        }

        function joinGame(gameId) {
            if (!gameId || gameId.length !== 6) {
                showError("Please enter a valid Game ID (6 characters)");
                return;
            }
            
            debug(`Joining game with ID: ${gameId}`);
            gameState.gameId = gameId;
            
            // Check if game exists
            const gameRef = db.ref(`games/${gameId}`);
            gameRef.once("value").then(snapshot => {
                const gameData = snapshot.val();
                
                if (!gameData) {
                    showError("Game not found. Please check the Game ID.");
                    return;
                }
                
                if (gameData.status === "expired") {
                    showError("This game has expired. Please create a new game.");
                    return;
                }
                
                // Join the game
                gameState.playerSymbol = "O"; // Second player is O
                gameState.opponentSymbol = "X";
                gameState.board = gameData.board || ["", "", "", "", "", "", "", "", ""];
                gameState.currentPlayer = gameData.currentTurn || "X";
                gameState.status = gameData.status === "waiting" ? "playing" : gameData.status;
                
                // Update game status in Firebase
                gameRef.update({
                    status: "playing",
                    joinedBy: tgApp.initDataUnsafe && tgApp.initDataUnsafe.user ? tgApp.initDataUnsafe.user.id : null,
                    joinerName: gameState.playerName
                }).then(() => {
                    gameIdDisplayElement.textContent = gameId;
                    gameIdDisplayElement.classList.add("visible");
                    
                    // Listen for game updates
                    listenToGameUpdates(gameId);
                    
                    renderBoard();
                    updateStatus();
                    showSuccess("Joined game successfully!");
                }).catch(error => {
                    debug(`Error joining game: ${error.message}`);
                    showError("Failed to join game. Please try again.");
                });
            }).catch(error => {
                debug(`Error joining game: ${error.message}`);
                showError("Failed to join game. Please try again.");
            });
        }

        function listenToGameUpdates(gameId) {
            const gameRef = db.ref(`games/${gameId}`);
            
            // Remove any existing listeners
            gameRef.off();
            
            // Listen for changes
            gameRef.on("value", snapshot => {
                const gameData = snapshot.val();
                
                if (!gameData) {
                    showError("Game no longer exists.");
                    return;
                }
                
                // Update local game state
                gameState.board = gameData.board || gameState.board;
                gameState.currentPlayer = gameData.currentTurn || gameState.currentPlayer;
                
                if (gameData.status === "expired") {
                    gameState.status = "expired";
                    showError("This game has expired.");
                }
                
                renderBoard();
                updateStatus();
                
                // Check for game result
                const result = checkGameResult();
                if (result.status !== "playing") {
                    gameState.status = result.status;
                    updateStatus();
                    
                    if (result.status === "win" && gameState.currentPlayer === gameState.playerSymbol) {
                        showConfetti();
                    }
                }
            });
        }

        function shareGame() {
            if (gameState.gameMode === "friend" && gameState.gameId) {
                // Share game ID with Telegram
                if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                    tgApp.sendData(JSON.stringify({
                        type: "share_game",
                        game_id: gameState.gameId,
                        game_type: "ttt"
                    }));
                } else {
                    // Fallback for testing in browser
                    const shareUrl = `${window.location.origin}${window.location.pathname}?gameId=${gameState.gameId}&gameType=ttt`;
                    navigator.clipboard.writeText(shareUrl)
                        .then(() => showSuccess("Game link copied to clipboard!"))
                        .catch(() => showError("Failed to copy game link."));
                }
            } else {
                showError("Create a multiplayer game first!");
            }
        }

        // RPS Game Functions
        function handleRpsChoice(event) {
            const choiceElement = event.target.closest('.rps-choice');
            if (!choiceElement) return;
            
            if (rpsGameState.status !== "playing") {
                return;
            }
            
            const choice = choiceElement.dataset.choice;
            
            if (rpsGameState.gameMode === "ai") {
                // Handle AI mode
                makeRpsMove(choice);
                
                setTimeout(() => {
                    makeRpsAIMove();
                }, 1000);
            } else if (rpsGameState.gameMode === "friend" && rpsGameState.gameId) {
                // Handle friend mode with Firebase
                const gameRef = db.ref(`rps_games/${rpsGameState.gameId}`);
                
                gameRef.once("value").then(snapshot => {
                    const gameData = snapshot.val();
                    
                    if (!gameData) {
                        showError("Game not found.");
                        return;
                    }
                    
                    // Check if player has already made a choice
                    const isCreator = tgApp.initDataUnsafe && tgApp.initDataUnsafe.user && 
                                     gameData.createdBy === tgApp.initDataUnsafe.user.id;
                    
                    if (isCreator) {
                        if (gameData.creatorChoice) {
                            showError("You've already made your choice!");
                            return;
                        }
                        
                        // Update creator's choice
                        gameRef.update({
                            creatorChoice: choice
                        }).then(() => {
                            debug(`Creator choice updated: ${choice}`);
                            showSuccess("Your choice has been recorded!");
                            
                            // Update UI
                            updateRpsPlayerChoice(choice);
                            
                            // Check if both players have made choices
                            if (gameData.joinerChoice) {
                                determineRpsWinner(choice, gameData.joinerChoice);
                            } else {
                                rpsStatusElement.textContent = "Waiting for opponent...";
                            }
                        }).catch(error => {
                            debug(`Error updating choice: ${error.message}`);
                            showError("Failed to update choice. Please try again.");
                        });
                    } else {
                        if (gameData.joinerChoice) {
                            showError("You've already made your choice!");
                            return;
                        }
                        
                        // Update joiner's choice
                        gameRef.update({
                            joinerChoice: choice
                        }).then(() => {
                            debug(`Joiner choice updated: ${choice}`);
                            showSuccess("Your choice has been recorded!");
                            
                            // Update UI
                            updateRpsPlayerChoice(choice);
                            
                            // Check if both players have made choices
                            if (gameData.creatorChoice) {
                                determineRpsWinner(choice, gameData.creatorChoice);
                            } else {
                                rpsStatusElement.textContent = "Waiting for opponent...";
                            }
                        }).catch(error => {
                            debug(`Error updating choice: ${error.message}`);
                            showError("Failed to update choice. Please try again.");
                        });
                    }
                }).catch(error => {
                    debug(`Error getting game data: ${error.message}`);
                    showError("Failed to get game data. Please try again.");
                });
            } else {
                showError("Create or join a game first!");
            }
        }

        function makeRpsMove(choice) {
            rpsGameState.playerChoice = choice;
            updateRpsPlayerChoice(choice);
        }

        function makeRpsAIMove() {
            if (rpsGameState.status !== "playing") {
                return;
            }
            
            let aiChoice;
            
            switch (rpsGameState.difficulty) {
                case "easy":
                    // Random choice
                    aiChoice = getRandomRpsChoice();
                    break;
                case "medium":
                    // 50% random, 50% counter player's choice
                    if (Math.random() < 0.5) {
                        aiChoice = getRandomRpsChoice();
                    } else {
                        aiChoice = getCounterRpsChoice(rpsGameState.playerChoice);
                    }
                    break;
                case "hard":
                    // 80% counter player's choice, 20% random
                    if (Math.random() < 0.8) {
                        aiChoice = getCounterRpsChoice(rpsGameState.playerChoice);
                    } else {
                        aiChoice = getRandomRpsChoice();
                    }
                    break;
                default:
                    aiChoice = getRandomRpsChoice();
            }
            
            rpsGameState.opponentChoice = aiChoice;
            updateRpsOpponentChoice(aiChoice);
            
            // Determine winner
            determineRpsWinner(rpsGameState.playerChoice, aiChoice);
        }

        function getRandomRpsChoice() {
            const choices = ["rock", "paper", "scissors"];
            return choices[Math.floor(Math.random() * choices.length)];
        }

        function getCounterRpsChoice(playerChoice) {
            switch (playerChoice) {
                case "rock": return "paper";
                case "paper": return "scissors";
                case "scissors": return "rock";
                default: return getRandomRpsChoice();
            }
        }

        function updateRpsPlayerChoice(choice) {
            // Clear all selections
            document.querySelectorAll('.rps-choice').forEach(el => {
                el.classList.remove('selected', 'win', 'lose');
            });
            
            // Highlight selected choice
            const selectedElement = document.querySelector(`.rps-choice[data-choice="${choice}"]`);
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
            
            // Update player choice display
            const iconClass = getChoiceIconClass(choice);
            playerChoiceDisplayElement.innerHTML = `<i class="${iconClass}"></i>`;
        }

        function updateRpsOpponentChoice(choice) {
            // Update opponent choice display
            const iconClass = getChoiceIconClass(choice);
            computerChoiceDisplayElement.innerHTML = `<i class="${iconClass}"></i>`;
        }

        function getChoiceIconClass(choice) {
            switch (choice) {
                case "rock": return "fas fa-hand-rock";
                case "paper": return "fas fa-hand-paper";
                case "scissors": return "fas fa-hand-scissors";
                default: return "fas fa-question";
            }
        }

        function determineRpsWinner(playerChoice, opponentChoice) {
            let result;
            
            if (playerChoice === opponentChoice) {
                result = "draw";
                rpsStatusElement.textContent = "It's a draw!";
                rpsStatusElement.classList.add("draw");
            } else if (
                (playerChoice === "rock" && opponentChoice === "scissors") ||
                (playerChoice === "paper" && opponentChoice === "rock") ||
                (playerChoice === "scissors" && opponentChoice === "paper")
            ) {
                result = "win";
                rpsStatusElement.textContent = "You win!";
                rpsStatusElement.classList.add("win");
                document.querySelector(`.rps-choice[data-choice="${playerChoice}"]`).classList.add('win');
                
                // Update player stats
                gameState.playerStats.wins++;
                gameState.playerStats.games++;
                gameState.playerStats.rpsWins++;
                gameState.playerStats.rpsGames++;
                gameState.playerStats.winRate = Math.round((gameState.playerStats.wins / gameState.playerStats.games) * 100);
                updateStatsUI();
                updatePlayerStatsInFirebase();
                updateLeaderboard("rps");
                showConfetti();
            } else {
                result = "loss";
                rpsStatusElement.textContent = "You lose!";
                rpsStatusElement.classList.add("draw");
                document.querySelector(`.rps-choice[data-choice="${playerChoice}"]`).classList.add('lose');
                
                // Update player stats
                gameState.playerStats.games++;
                gameState.playerStats.rpsGames++;
                gameState.playerStats.winRate = Math.round((gameState.playerStats.wins / gameState.playerStats.games) * 100);
                updateStatsUI();
                updatePlayerStatsInFirebase();
            }
            
            rpsGameState.result = result;
            rpsGameState.status = "finished";
            
            // Add to game history
            addGameToHistory(result, "rps");
        }

        function resetRpsGame() {
            rpsGameState.playerChoice = null;
            rpsGameState.opponentChoice = null;
            rpsGameState.result = null;
            rpsGameState.status = "playing";
            
            // Reset UI
            document.querySelectorAll('.rps-choice').forEach(el => {
                el.classList.remove('selected', 'win', 'lose');
            });
            
            playerChoiceDisplayElement.innerHTML = `<i class="fas fa-question"></i>`;
            computerChoiceDisplayElement.innerHTML = `<i class="fas fa-question"></i>`;
            
            rpsStatusElement.textContent = "Choose your move";
            rpsStatusElement.classList.remove("win", "draw");
            
            if (rpsGameState.gameMode === "friend" && rpsGameState.gameId) {
                // Reset game in Firebase
                const gameRef = db.ref(`rps_games/${rpsGameState.gameId}`);
                gameRef.update({
                    creatorChoice: null,
                    joinerChoice: null,
                    status: "playing",
                    result: null
                }).then(() => {
                    showSuccess("Game reset successfully!");
                }).catch(error => {
                    debug(`Error resetting game: ${error.message}`);
                    showError("Failed to reset game. Please try again.");
                });
            }
        }

        function createNewRpsGame() {
            debug("Creating new RPS game...");
            
            // Generate a random game ID (6 characters)
            const gameId = Math.random().toString(36).substring(2, 8).toUpperCase();
            rpsGameState.gameId = gameId;
            
            // Create game in Firebase
            const gameRef = db.ref(`rps_games/${gameId}`);
            gameRef.set({
                id: gameId,
                creatorChoice: null,
                joinerChoice: null,
                status: "waiting",
                gameType: "rps",
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                expiryTime: Date.now() + (30 * 60 * 1000), // 30 minutes expiry
                createdBy: tgApp.initDataUnsafe && tgApp.initDataUnsafe.user ? tgApp.initDataUnsafe.user.id : null,
                creatorName: gameState.playerName
            }).then(() => {
                debug(`RPS game created with ID: ${gameId}`);
                rpsGameIdInputElement.value = gameId;
                rpsGameIdDisplayElement.textContent = gameId;
                rpsGameIdDisplayElement.classList.add("visible");
                
                // Listen for game updates
                listenToRpsGameUpdates(gameId);
                
                // Share game ID with Telegram
                if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                    tgApp.sendData(JSON.stringify({
                        type: "share_game",
                        game_id: gameId,
                        game_type: "rps"
                    }));
                }
                
                showSuccess(`Game created! ID: ${gameId}`);
            }).catch(error => {
                debug(`Error creating RPS game: ${error.message}`);
                showError("Failed to create game. Please try again.");
            });
        }

        function joinRpsGame(gameId) {
            if (!gameId || gameId.length !== 6) {
                showError("Please enter a valid Game ID (6 characters)");
                return;
            }
            
            debug(`Joining RPS game with ID: ${gameId}`);
            rpsGameState.gameId = gameId;
            
            // Check if game exists
            const gameRef = db.ref(`rps_games/${gameId}`);
            gameRef.once("value").then(snapshot => {
                const gameData = snapshot.val();
                
                if (!gameData) {
                    showError("Game not found. Please check the Game ID.");
                    return;
                }
                
                if (gameData.status === "expired") {
                    showError("This game has expired. Please create a new game.");
                    return;
                }
                
                // Join the game
                rpsGameState.status = gameData.status === "waiting" ? "playing" : gameData.status;
                
                // Update game status in Firebase
                gameRef.update({
                    status: "playing",
                    joinedBy: tgApp.initDataUnsafe && tgApp.initDataUnsafe.user ? tgApp.initDataUnsafe.user.id : null,
                    joinerName: gameState.playerName
                }).then(() => {
                    rpsGameIdDisplayElement.textContent = gameId;
                    rpsGameIdDisplayElement.classList.add("visible");
                    
                    // Listen for game updates
                    listenToRpsGameUpdates(gameId);
                    
                    rpsStatusElement.textContent = "Choose your move";
                    showSuccess("Joined game successfully!");
                }).catch(error => {
                    debug(`Error joining RPS game: ${error.message}`);
                    showError("Failed to join game. Please try again.");
                });
            }).catch(error => {
                debug(`Error joining RPS game: ${error.message}`);
                showError("Failed to join game. Please try again.");
            });
        }

        function listenToRpsGameUpdates(gameId) {
            const gameRef = db.ref(`rps_games/${gameId}`);
            
            // Remove any existing listeners
            gameRef.off();
            
            // Listen for changes
            gameRef.on("value", snapshot => {
                const gameData = snapshot.val();
                
                if (!gameData) {
                    showError("Game no longer exists.");
                    return;
                }
                
                if (gameData.status === "expired") {
                    rpsGameState.status = "expired";
                    showError("This game has expired.");
                    return;
                }
                
                // Check if both players have made choices
                if (gameData.creatorChoice && gameData.joinerChoice) {
                    // Determine if current user is creator or joiner
                    const isCreator = tgApp.initDataUnsafe && tgApp.initDataUnsafe.user && 
                                     gameData.createdBy === tgApp.initDataUnsafe.user.id;
                    
                    if (isCreator) {
                        updateRpsPlayerChoice(gameData.creatorChoice);
                        updateRpsOpponentChoice(gameData.joinerChoice);
                        determineRpsWinner(gameData.creatorChoice, gameData.joinerChoice);
                    } else {
                        updateRpsPlayerChoice(gameData.joinerChoice);
                        updateRpsOpponentChoice(gameData.creatorChoice);
                        determineRpsWinner(gameData.joinerChoice, gameData.creatorChoice);
                    }
                } else if (gameData.creatorChoice || gameData.joinerChoice) {
                    // Only one player has made a choice
                    const isCreator = tgApp.initDataUnsafe && tgApp.initDataUnsafe.user && 
                                     gameData.createdBy === tgApp.initDataUnsafe.user.id;
                    
                    if (isCreator && gameData.creatorChoice) {
                        updateRpsPlayerChoice(gameData.creatorChoice);
                        rpsStatusElement.textContent = "Waiting for opponent...";
                    } else if (!isCreator && gameData.joinerChoice) {
                        updateRpsPlayerChoice(gameData.joinerChoice);
                        rpsStatusElement.textContent = "Waiting for opponent...";
                    } else {
                        rpsStatusElement.textContent = "Opponent has made their choice. Your turn!";
                    }
                }
            });
        }

        function shareRpsGame() {
            if (rpsGameState.gameMode === "friend" && rpsGameState.gameId) {
                // Share game ID with Telegram
                if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                    tgApp.sendData(JSON.stringify({
                        type: "share_game",
                        game_id: rpsGameState.gameId,
                        game_type: "rps"
                    }));
                } else {
                    // Fallback for testing in browser
                    const shareUrl = `${window.location.origin}${window.location.pathname}?gameId=${rpsGameState.gameId}&gameType=rps`;
                    navigator.clipboard.writeText(shareUrl)
                        .then(() => showSuccess("Game link copied to clipboard!"))
                        .catch(() => showError("Failed to copy game link."));
                }
            } else {
                showError("Create a multiplayer game first!");
            }
        }

        function updateLeaderboard(gameType) {
            // Update leaderboard in Telegram
            if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                tgApp.sendData(JSON.stringify({
                    type: "update_leaderboard",
                    game_type: gameType
                }));
                debug(`Sent ${gameType} leaderboard update to Telegram`);
            }
        }

        function updatePlayerStatsInFirebase() {
            if (!tgApp.initDataUnsafe || !tgApp.initDataUnsafe.user) return;
            
            const userId = tgApp.initDataUnsafe.user.id;
            const userRef = db.ref(`users/${userId}`);
            
            userRef.update({
                name: gameState.playerName,
                wins: gameState.playerStats.wins,
                games: gameState.playerStats.games,
                winRate: gameState.playerStats.winRate,
                tttWins: gameState.playerStats.tttWins,
                tttGames: gameState.playerStats.tttGames,
                rpsWins: gameState.playerStats.rpsWins,
                rpsGames: gameState.playerStats.rpsGames,
                lastPlayed: firebase.database.ServerValue.TIMESTAMP
            }).catch(error => {
                debug(`Error updating player stats: ${error.message}`);
            });
        }

        function addGameToHistory(result, gameType) {
            if (!tgApp.initDataUnsafe || !tgApp.initDataUnsafe.user) return;
            
            const userId = tgApp.initDataUnsafe.user.id;
            const historyRef = db.ref(`users/${userId}/history`).push();
            
            historyRef.set({
                result: result,
                gameType: gameType,
                mode: gameType === "ttt" ? gameState.gameMode : rpsGameState.gameMode,
                difficulty: gameType === "ttt" ? 
                    (gameState.gameMode === "ai" ? gameState.difficulty : null) : 
                    (rpsGameState.gameMode === "ai" ? rpsGameState.difficulty : null),
                opponent: gameType === "ttt" ? 
                    (gameState.gameMode === "friend" ? "Friend" : "AI") : 
                    (rpsGameState.gameMode === "friend" ? "Friend" : "AI"),
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                // Reload history
                loadGameHistory();
            }).catch(error => {
                debug(`Error adding game to history: ${error.message}`);
            });
        }

        function loadLeaderboard() {
            // Load All Leaderboard
            const allLeaderboardRef = db.ref("users");
            allLeaderboardRef.orderByChild("wins").limitToLast(10).once("value").then(snapshot => {
                allLeaderboardLoadingElement.style.display = "none";
    
                if (!snapshot.exists()) {
                    allLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>No data yet</li>";
                    return;
                }
    
                const leaderboardData = [];
                snapshot.forEach(childSnapshot => {
                    const userData = childSnapshot.val();
                    // Only include users who have wins greater than 0
                    if (userData.wins && userData.wins > 0) {
                        leaderboardData.push({
                            id: childSnapshot.key,
                            ...userData
                        });
                    }
                });
    
                // Check if we have any valid entries
                if (leaderboardData.length === 0) {
                    allLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>No leaderboard data yet</li>";
                    return;
                }
    
                // Sort by wins (descending)
                leaderboardData.sort((a, b) => b.wins - a.wins);
    
                // Render leaderboard
                allLeaderboardListElement.innerHTML = "";
                leaderboardData.forEach((player, index) => {
                    const listItem = document.createElement("li");
                    listItem.className = "leaderboard-item";
    
                    const rankClass = index < 3 ? "top-rank" : "";
                    const initial = player.name ? player.name.charAt(0).toUpperCase() : "?";
    
                    listItem.innerHTML = `
                        <span class="player-rank ${rankClass}">${index + 1}</span>
                        <div class="player-info">
                            <div class="player-avatar">${initial}</div>
                            <span class="player-name">${player.name || "Unknown"}</span>
                        </div>
                        <span class="player-wins">${player.wins} wins</span>
                    `;
                    allLeaderboardListElement.appendChild(listItem);
                });
            }).catch(error => {
                debug(`Error loading all leaderboard: ${error.message}`);
                allLeaderboardLoadingElement.style.display = "none";
                allLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>Failed to load leaderboard</li>";
            });

            // Load TTT Leaderboard
            const tttLeaderboardRef = db.ref("users");
            tttLeaderboardRef.orderByChild("tttWins").limitToLast(10).once("value").then(snapshot => {
                tttLeaderboardLoadingElement.style.display = "none";
    
                if (!snapshot.exists()) {
                    tttLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>No data yet</li>";
                    return;
                }
    
                const leaderboardData = [];
                snapshot.forEach(childSnapshot => {
                    const userData = childSnapshot.val();
                    // Only include users who have tttWins greater than 0
                    if (userData.tttWins && userData.tttWins > 0) {
                        leaderboardData.push({
                            id: childSnapshot.key,
                            ...userData
                        });
                    }
                });
    
                // Check if we have any valid entries
                if (leaderboardData.length === 0) {
                    tttLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>No leaderboard data yet</li>";
                    return;
                }
    
                // Sort by TTT wins (descending)
                leaderboardData.sort((a, b) => b.tttWins - a.tttWins);
    
                // Render leaderboard
                tttLeaderboardListElement.innerHTML = "";
                leaderboardData.forEach((player, index) => {
                    const listItem = document.createElement("li");
                    listItem.className = "leaderboard-item";
    
                    const rankClass = index < 3 ? "top-rank" : "";
                    const initial = player.name ? player.name.charAt(0).toUpperCase() : "?";
    
                    listItem.innerHTML = `
                        <span class="player-rank ${rankClass}">${index + 1}</span>
                        <div class="player-info">
                            <div class="player-avatar">${initial}</div>
                            <span class="player-name">${player.name || "Unknown"}</span>
                        </div>
                        <span class="player-wins">${player.tttWins} wins</span>
                    `;
                    tttLeaderboardListElement.appendChild(listItem);
                });
            }).catch(error => {
                debug(`Error loading TTT leaderboard: ${error.message}`);
                tttLeaderboardLoadingElement.style.display = "none";
                tttLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>Failed to load leaderboard</li>";
            });

            // Load RPS Leaderboard
            const rpsLeaderboardRef = db.ref("users");
            rpsLeaderboardRef.orderByChild("rpsWins").limitToLast(10).once("value").then(snapshot => {
                rpsLeaderboardLoadingElement.style.display = "none";
    
                if (!snapshot.exists()) {
                    rpsLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>No data yet</li>";
                    return;
                }
    
                const leaderboardData = [];
                snapshot.forEach(childSnapshot => {
                    const userData = childSnapshot.val();
                    // Only include users who have rpsWins greater than 0
                    if (userData.rpsWins && userData.rpsWins > 0) {
                        leaderboardData.push({
                            id: childSnapshot.key,
                            ...userData
                        });
                    }
                });
    
                // Check if we have any valid entries
                if (leaderboardData.length === 0) {
                    rpsLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>No leaderboard data yet</li>";
                    return;
                }
    
                // Sort by RPS wins (descending)
                leaderboardData.sort((a, b) => b.rpsWins - a.rpsWins);
    
                // Render leaderboard
                rpsLeaderboardListElement.innerHTML = "";
                leaderboardData.forEach((player, index) => {
                    const listItem = document.createElement("li");
                    listItem.className = "leaderboard-item";
    
                    const rankClass = index < 3 ? "top-rank" : "";
                    const initial = player.name ? player.name.charAt(0).toUpperCase() : "?";
    
                    listItem.innerHTML = `
                        <span class="player-rank ${rankClass}">${index + 1}</span>
                        <div class="player-info">
                            <div class="player-avatar">${initial}</div>
                            <span class="player-name">${player.name || "Unknown"}</span>
                        </div>
                        <span class="player-wins">${player.rpsWins} wins</span>
                    `;
                    rpsLeaderboardListElement.appendChild(listItem);
                });
            }).catch(error => {
                debug(`Error loading RPS leaderboard: ${error.message}`);
                rpsLeaderboardLoadingElement.style.display = "none";
                rpsLeaderboardListElement.innerHTML = "<li class='leaderboard-item'>Failed to load leaderboard</li>";
            });
        }

        function loadGameHistory() {
            if (!tgApp.initDataUnsafe || !tgApp.initDataUnsafe.user) {
                dashboardHistoryLoadingElement.style.display = "none";
                dashboardHistoryListElement.innerHTML = "<li class='history-item'>Sign in to view history</li>";
                profileHistoryLoadingElement.style.display = "none";
                profileHistoryListElement.innerHTML = "<li class='history-item'>Sign in to view history</li>";
                return;
            }
            
            const userId = tgApp.initDataUnsafe.user.id;
            const historyRef = db.ref(`users/${userId}/history`).limitToLast(10);
            
            historyRef.once("value").then(snapshot => {
                dashboardHistoryLoadingElement.style.display = "none";
                profileHistoryLoadingElement.style.display = "none";
                
                if (!snapshot.exists()) {
                    dashboardHistoryListElement.innerHTML = "<li class='history-item'>No games played yet</li>";
                    profileHistoryListElement.innerHTML = "<li class='history-item'>No games played yet</li>";
                    return;
                }
                
                const historyData = [];
                snapshot.forEach(childSnapshot => {
                    historyData.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by timestamp (descending)
                historyData.sort((a, b) => b.timestamp - a.timestamp);
                
                // Render history for dashboard
                dashboardHistoryListElement.innerHTML = "";
                profileHistoryListElement.innerHTML = "";
                
                historyData.forEach(game => {
                    // Create dashboard history item
                    const dashboardListItem = document.createElement("li");
                    dashboardListItem.className = "history-item";
                    
                    // Create profile history item
                    const profileListItem = document.createElement("li");
                    profileListItem.className = "history-item";
                    
                    const date = new Date(game.timestamp);
                    const formattedDate = date.toLocaleDateString() + " " + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    let resultClass = "";
                    let resultText = "";
                    
                    if (game.result === "win") {
                        resultClass = "result-win";
                        resultText = "Victory";
                    } else if (game.result === "loss") {
                        resultClass = "result-loss";
                        resultText = "Defeat";
                    } else {
                        resultClass = "result-draw";
                        resultText = "Draw";
                    }
                    
                    const gameTypeIcon = game.gameType === "ttt" ? 
                        '<i class="fas fa-th"></i>' : 
                        '<i class="fas fa-hand-rock"></i>';
                    
                    const gameTypeText = game.gameType === "ttt" ? "TicTacToe" : "Rock Paper Scissors";
                    
                    dashboardListItem.innerHTML = `
                        <div class="history-header">
                            <span class="history-date">${formattedDate}</span>
                            <span class="history-result ${resultClass}">${resultText}</span>
                        </div>
                        <div class="history-details">
                            <span class="history-mode">${gameTypeIcon} ${gameTypeText}</span>
                            <span class="history-opponent">vs ${game.opponent} ${game.difficulty ? `(${game.difficulty})` : ""}</span>
                        </div>
                    `;
                    
                    profileListItem.innerHTML = dashboardListItem.innerHTML;
                    
                    dashboardHistoryListElement.appendChild(dashboardListItem);
                    profileHistoryListElement.appendChild(profileListItem);
                });
            }).catch(error => {
                debug(`Error loading game history: ${error.message}`);
                dashboardHistoryLoadingElement.style.display = "none";
                profileHistoryLoadingElement.style.display = "none";
                dashboardHistoryListElement.innerHTML = "<li class='history-item'>Failed to load game history</li>";
                profileHistoryListElement.innerHTML = "<li class='history-item'>Failed to load game history</li>";
            });
        }

        function loadNotifications() {
            notificationsLoadingElement.style.display = "none";
            
            if (!tgApp.initDataUnsafe || !tgApp.initDataUnsafe.user) {
                notificationsListElement.innerHTML = "<div class='history-item'>Sign in to view notifications</div>";
                return;
            }
            
            const userId = tgApp.initDataUnsafe.user.id;
            const notificationsRef = db.ref(`users/${userId}/notifications`).limitToLast(20);
            
            notificationsRef.once("value").then(snapshot => {
                if (!snapshot.exists()) {
                    notificationsListElement.innerHTML = "<div class='notification-item'><div class='notification-content'><div class='notification-message'>No notifications yet</div></div></div>";
                    return;
                }
                
                const notificationsData = [];
                snapshot.forEach(childSnapshot => {
                    notificationsData.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by timestamp (descending)
                notificationsData.sort((a, b) => b.timestamp - a.timestamp);
                
                // Render notifications
                notificationsListElement.innerHTML = "";
                
                notificationsData.forEach(notification => {
                    const notificationItem = document.createElement("div");
                    notificationItem.className = "notification-item";
                    
                    const date = new Date(notification.timestamp);
                    const formattedDate = date.toLocaleDateString() + " " + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    let iconClass = "fas fa-bell";
                    
                    if (notification.type === "game_invite") {
                        iconClass = "fas fa-gamepad";
                    } else if (notification.type === "achievement") {
                        iconClass = "fas fa-trophy";
                    } else if (notification.type === "system") {
                        iconClass = "fas fa-info-circle";
                    }
                    
                    let actionsHtml = '';
                    
                    if (notification.actions) {
                        actionsHtml = '<div class="notification-actions">';
                        
                        if (notification.actions.primary) {
                            actionsHtml += `<button class="notification-btn primary" data-action="${notification.actions.primary.action}" data-notification-id="${notification.id}">${notification.actions.primary.text}</button>`;
                        }
                        
                        if (notification.actions.secondary) {
                            actionsHtml += `<button class="notification-btn secondary" data-action="${notification.actions.secondary.action}" data-notification-id="${notification.id}">${notification.actions.secondary.text}</button>`;
                        }
                        
                        actionsHtml += '</div>';
                    }
                    
                    notificationItem.innerHTML = `
                        <div class="notification-icon">
                            <i class="${iconClass}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title || 'Notification'}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${formattedDate}</div>
                            ${actionsHtml}
                        </div>
                    `;
                    
                    notificationsListElement.appendChild(notificationItem);
                });
                
                // Add event listeners for notification actions
                document.querySelectorAll('.notification-btn').forEach(button => {
                    button.addEventListener('click', handleNotificationAction);
                });
            }).catch(error => {
                debug(`Error loading notifications: ${error.message}`);
                notificationsLoadingElement.style.display = "none";
                notificationsListElement.innerHTML = "<div class='notification-item'><div class='notification-content'><div class='notification-message'>Failed to load notifications</div></div></div>";
            });
        }

        function handleNotificationAction(event) {
            const action = event.target.dataset.action;
            const notificationId = event.target.dataset.notificationId;
            
            if (!action || !notificationId) return;
            
            debug(`Notification action: ${action}, ID: ${notificationId}`);
            
            if (action === 'dismiss') {
                // Remove notification
                if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                    const userId = tgApp.initDataUnsafe.user.id;
                    const notificationRef = db.ref(`users/${userId}/notifications/${notificationId}`);
                    
                    notificationRef.remove()
                        .then(() => {
                            // Remove from UI
                            const notificationItem = event.target.closest('.notification-item');
                            if (notificationItem) {
                                notificationItem.remove();
                            }
                            
                            showSuccess("Notification dismissed");
                        })
                        .catch(error => {
                            debug(`Error dismissing notification: ${error.message}`);
                            showError("Failed to dismiss notification");
                        });
                }
            } else if (action === 'join_game') {
                // Get game details from notification
                if (tgApp.initDataUnsafe && tgApp.initDataUnsafe.user) {
                    const userId = tgApp.initDataUnsafe.user.id;
                    const notificationRef = db.ref(`users/${userId}/notifications/${notificationId}`);
                    
                    notificationRef.once('value')
                        .then(snapshot => {
                            const notification = snapshot.val();
                            
                            if (notification && notification.data) {
                                const gameId = notification.data.gameId;
                                const gameType = notification.data.gameType;
                                
                                if (gameId) {
                                    if (gameType === 'rps') {
                                        // Join RPS game
                                        switchSection('rpsGameSection');
                                        rpsGameState.gameMode = "friend";
                                        rpsGameState.gameId = gameId;
                                        updateRpsGameModeUI();
                                        joinRpsGame(gameId);
                                    } else {
                                        // Default to TicTacToe
                                        switchSection('tttGameSection');
                                        gameState.gameMode = "friend";
                                        gameState.gameId = gameId;
                                        updateGameModeUI();
                                        joinGame(gameId);
                                    }
                                }
                            }
                        })
                        .catch(error => {
                            debug(`Error getting notification details: ${error.message}`);
                            showError("Failed to join game");
                        });
                }
            }
        }

        function showConfetti() {
            confettiContainer.classList.add("active");
            
            // Create confetti pieces
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement("div");
                confetti.className = "confetti";
                confetti.style.left = Math.random() * 100 + "vw";
                confetti.style.animationDelay = Math.random() * 3 + "s";
                confetti.style.backgroundColor = getRandomColor();
                confettiContainer.appendChild(confetti);
            }
            
            // Remove confetti after animation
            setTimeout(() => {
                confettiContainer.classList.remove("active");
                confettiContainer.innerHTML = "";
            }, 4000);
        }

        function getRandomColor() {
            const colors = [
                "#f44336", "#e91e63", "#9c27b0", "#673ab7", 
                "#3f51b5", "#2196f3", "#03a9f4", "#00bcd4", 
                "#009688", "#4caf50", "#8bc34a", "#cddc39", 
                "#ffeb3b", "#ffc107", "#ff9800", "#ff5722"
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Dashboard event listeners
        document.getElementById('playNowBtn').addEventListener('click', () => {
            switchSection('gamesSection');
            document.getElementById('gamesSection').classList.add('visible');
        });

        document.getElementById('playTTTBtn').addEventListener('click', () => {
            switchSection('tttGameSection');
        });

        document.getElementById('playRPSBtn').addEventListener('click', () => {
            switchSection('rpsGameSection');
        });

        // Enable debug mode in development
        if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
            document.getElementById("debugPanel").classList.add("visible");
        }
    </script>
</body>
</html>
